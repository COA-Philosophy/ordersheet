<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>オーダーシート：CSV保存</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 2rem;
    }
    label {
      display: block;
      margin-top: 1em;
    }
    input, select {
      width: 100%;
      max-width: 400px;
      padding: 0.5em;
      margin-top: 0.2em;
    }
    button {
      margin-top: 2em;
      padding: 0.7em 1.5em;
    }
  </style>
</head>
<body>

  <h1>オーダーシート簡易版</h1>
  <form id="orderForm">
    <label>姓：<input type="text" name="lastName" required></label>
    <label>名：<input type="text" name="firstName" required></label>
    <label>性別：
      <select name="gender">
        <option value="male">男性</option>
        <option value="female">女性</option>
        <option value="other">その他</option>
      </select>
    </label>
    <label>電話番号：<input type="text" name="phone"></label>
    <label>メールアドレス：<input type="email" name="email"></label>
    <label>アイテム数：<input type="number" name="itemCount" required></label>
    <label>支払方法：
      <select name="paymentMethod">
        <option value="cash">現金</option>
        <option value="card">クレジットカード</option>
        <option value="transfer">銀行振込</option>
      </select>
    </label>
    <button type="button" onclick="saveToCSV()">CSV保存</button>
  </form>

  <div id="status"></div>

  <script>
    function collectFormData() {
      const form = document.getElementById('orderForm');
      const formData = {
        lastName: form.lastName.value,
        firstName: form.firstName.value,
        gender: form.gender.value,
        phone: form.phone.value,
        email: form.email.value,
        orderNumber: 'ORD' + Date.now(),
        orderDate: new Date().toLocaleDateString('ja-JP'),
        items: [
          {
            itemType: 'ジャケット',
            fabric: 'Super 120s ウール',
            color: 'ネイビー',
            jacketStyle: 'single',
            lapelStyle: 'notched',
            cuffStyle: '4button',
            options: ['AMFステッチ', '裏地キュプラ'],
            price: 88000,
            deliveryDate: '2025-07-01',
            notes: '夏仕様'
          }
        ],
        measurements: {
          height: 170,
          weight: 65,
          chest: 90,
          waist: 78,
          shoulderWidth: 45
        },
        totalPrice: 88000,
        payment: {
          method: form.paymentMethod.value,
          deposit: 30000,
          balance: 58000,
          orderDate: new Date().toLocaleDateString('ja-JP'),
          fittingDate: '',
          completionDate: ''
        },
        generalNotes: '初回注文'
      };
      return formData;
    }

    function showStatusMessage(msg, type) {
      const el = document.getElementById('status');
      el.textContent = msg;
      el.style.color = type === 'success' ? 'green' : 'red';
    }

    // あなたの関数をここに貼り付け（saveToCSV, saveCustomerMasterCSV など）
    // ここでは簡易的に顧客CSVだけ呼び出します（本番用にあなたのコード全部貼ること）
    function saveToCSV() {
      try {
        const formData = collectFormData();
        const now = new Date();
        const dateStr = now.getFullYear() + 
                        String(now.getMonth() + 1).padStart(2, '0') + 
                        String(now.getDate()).padStart(2, '0');
        const customerName = formData.lastName + formData.firstName || 'お客様';

        // 顧客CSV（簡易版）
        const csvHeader = ['氏名','性別','電話','メール','支払方法','登録日'];
        const csvRow = [
          customerName,
          formData.gender,
          formData.phone,
          formData.email,
          formData.payment.method,
          dateStr
        ];
        const csvContent = csvHeader.join(',') + '\n' + csvRow.join(',');
        const blob = new Blob(["\uFEFF" + csvContent], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = `顧客マスター_${customerName}_${dateStr}.csv`;
        link.click();
        showStatusMessage('✅ CSV保存しました', 'success');
      } catch (e) {
        console.error(e);
        showStatusMessage('❌ エラーが発生しました', 'error');
      }
    }
  </script>

</body>
</html>
